<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados del Algoritmo Gen√©tico</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script th:src="@{/js/app.js}" defer></script>
</head>
<body>
<div class="container">
    <div class="results-header">
        <h1>üìä Resultados del Algoritmo Gen√©tico</h1>
        <p>Funci√≥n: <span th:text="${#objects.nullSafe(functionType, 'N/A')}"></span></p>
    </div>

    <div class="generation-info">
        <h3>üìã Par√°metros utilizados</h3>
        <p>
            <strong>Rango:</strong> [<span th:text="${xmin}"></span>, <span th:text="${xmax}"></span>] |
            <strong>Precisi√≥n:</strong> <span th:text="${L}"></span> bits |
            <strong>Total generaciones:</strong> <span th:text="${#lists.size(generations)}"></span>
        </p>
    </div>

    <!-- Gr√°fica -->
    <div class="chart-container" style="margin: 30px 0;">
        <h3>üìà Evoluci√≥n del Mejor Valor Adaptativo</h3>
        <img th:src="${chartImage}" alt="Gr√°fica de valores adaptativos"
             style="width: 100%; max-width: 800px; height: auto; border: 1px solid #ddd; border-radius: 4px;">
    </div>

    <!-- Controles de navegaci√≥n -->
    <div class="navigation-controls">
        <div class="nav-section">
            <!-- Bot√≥n Anterior -->
            <th:block th:if="${currentGeneration > 1}">
                <a class="nav-button"
                   th:href="@{/results(currentGeneration=${currentGeneration - 1})}">
                    ‚Üê Generaci√≥n Anterior
                </a>
            </th:block>
            <th:block th:if="${currentGeneration <= 1}">
                <span class="nav-button disabled">‚Üê Generaci√≥n Anterior</span>
            </th:block>
        </div>

        <div class="nav-section">
            <span class="current-generation">Generaci√≥n <span th:text="${currentGeneration}"></span></span>
            <span>de <span th:text="${#lists.size(generations)}"></span></span>
        </div>

        <div class="nav-section">
            <div class="jump-to-generation">
                <form th:action="@{/results}" method="get">
                    <label for="genInput" style="margin: 0; font-weight: normal;">Ir a:</label>
                    <input type="number" id="genInput" name="currentGeneration"
                           th:min="1" th:max="${#lists.size(generations)}"
                           th:value="${currentGeneration}" required>
                    <button type="submit">Ir</button>
                </form>
            </div>
        </div>

        <div class="nav-section">
            <!-- Bot√≥n Siguiente -->
            <th:block th:if="${currentGeneration < #lists.size(generations)}">
                <a class="nav-button"
                   th:href="@{/results(currentGeneration=${currentGeneration + 1})}">
                    Siguiente Generaci√≥n ‚Üí
                </a>
            </th:block>
            <th:block th:if="${currentGeneration >= #lists.size(generations)}">
                <span class="nav-button disabled">Siguiente Generaci√≥n ‚Üí</span>
            </th:block>
        </div>
    </div>

    <!-- Contenido de la generaci√≥n actual -->
    <th:block th:if="${generations != null and #lists.size(generations) >= currentGeneration}">
        <div class="generation-info">
            <h2 th:text="'Generaci√≥n ' + ${currentGeneration}"></h2>
            <p><strong>Total individuos:</strong> <span th:text="${#lists.size(generations[currentGeneration - 1])}"></span></p>
        </div>

        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>#</th>
                    <th>Binario (<span th:text="${L}"></span> bits)</th>
                    <th>Decimal</th>
                    <th>Valor Real</th>
                    <th>Adaptativo</th>
                    <th>Generaci√≥n</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="individual, rowStat : ${generations[currentGeneration - 1]}">
                    <td th:text="${rowStat.index + 1}"></td>
                    <td th:text="${individual.binary}"></td>
                    <td th:text="${binaryService.convertBinaryToInt(individual.binary)}"></td>
                    <td th:text="${#numbers.formatDecimal(individual.real, 1, 3)}"></td>
                    <td th:text="${#numbers.formatDecimal(individual.adaptative, 1, 3)}"></td>
                    <td th:text="${individual.generation + 1}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </th:block>

    <th:block th:if="${generations == null or #lists.size(generations) < currentGeneration}">
        <div style="color: red; font-weight: bold; padding: 20px; background: #ffeaea; border-radius: 5px; margin: 20px 0;">
            <h3>‚ùå Error</h3>
            <p>No hay datos disponibles para la Generaci√≥n <span th:text="${currentGeneration}"></span></p>
        </div>
    </th:block>

    <div style="margin-top: 20px;">
        <a href="/" class="back-button">üè† Volver al inicio</a>
    </div>
</div>
</body>
</html>